<div class="auth-page bg-surface-100 dark:bg-surface-950 transition-colors duration-500">
  <div class="auth-container">
    <div class="auth-back bg-primary/80 backdrop-blur-md rounded-[32px]">
      <div class="back-panel back-login flex flex-col justify-center items-center text-center p-6" [class.active]="!isLogin">
        <h1 class="text-2xl md:text-4xl font-bold mb-2">¿Ya tienes cuenta?</h1>
        <p class="mb-4 opacity-90 text-sm md:text-base">Entra para seguir disfrutando de MOVA</p>
        <p-button label="Iniciar Sesión" [outlined]="true" severity="secondary" (onClick)="toggleForm()" 
                  [style]="{'color': '#000080', 'font-weight': 'bold'}" styleClass="border-white hover:bg-white/20" />
      </div>

      <div class="back-panel back-register flex flex-col justify-center items-center text-center p-6" [class.active]="isLogin">
        <h1 class="text-2xl md:text-4xl font-bold mb-2">¿Eres nuevo?</h1>
        <p class="mb-4 opacity-90 text-sm md:text-base">Regístrate y descubre beneficios</p>
        <p-button label="Registrarse" [outlined]="true" severity="secondary" (onClick)="toggleForm()" 
                  [style]="{'color': '#000080', 'font-weight': 'bold'}" styleClass="border-white hover:bg-white/20" />
      </div>
    </div>

    <div class="auth-forms bg-surface-0 dark:bg-surface-900 border border-surface-200 dark:border-surface-800" [class.move-right]="!isLogin">
      <form class="form animate-fadein" *ngIf="isLogin" (submit)="$event.preventDefault()">
        <h2 class="text-3xl font-bold text-primary mb-6">Bienvenido</h2>
        <div class="flex flex-col gap-4">
          <input pInputText type="email" placeholder="Correo" [(ngModel)]="email" name="email" class="w-full h-12" />
          <p-password [(ngModel)]="password" name="password" [feedback]="false" [toggleMask]="true" placeholder="Contraseña" styleClass="w-full" inputStyleClass="w-full h-12" />
          
          <p-button label="Ingresar" [loading]="loading" (onClick)="login()" styleClass="w-full h-12 mt-2" />
          
          <p-button label="¿Olvidaste tu contraseña?" [text]="true" (onClick)="openForgotPassword()" styleClass="text-sm self-center" />
          
          <p-divider align="center"><span class="text-sm opacity-60">o</span></p-divider>
          <div id="googleBtn" class="flex justify-center"></div>
        </div>
      </form>

      <form class="form animate-fadein" *ngIf="!isLogin" (submit)="$event.preventDefault()">
        <h2 class="text-3xl font-bold text-primary mb-6">Crear Cuenta</h2>
        <div class="flex flex-col gap-3">
          <div class="flex flex-col gap-1">
            <label class="text-sm font-medium opacity-70">Nombre completo</label>
            <input pInputText placeholder="Ej: Juan Pérez" [(ngModel)]="fullName" name="fullName" class="w-full h-11" />
          </div>
          <div class="flex flex-col gap-1">
            <label class="text-sm font-medium opacity-70">Correo electrónico</label>
            <input pInputText type="email" placeholder="correo@ejemplo.com" [(ngModel)]="email" name="email" class="w-full h-11" />
          </div>
          <div class="flex flex-col gap-1">
            <label class="text-sm font-medium opacity-70">Contraseña</label>
            <p-password [(ngModel)]="password" name="password" [feedback]="true" [toggleMask]="true" placeholder="••••••••" styleClass="w-full" inputStyleClass="w-full h-11" />
          </div>
          <div *ngIf="registerError" class="text-red-500 text-xs p-2 bg-red-50 dark:bg-red-900/20 rounded border border-red-200 dark:border-red-800">
            {{ registerError }}
          </div>
          <p-button label="Registrarse" [loading]="registerLoading" (onClick)="register()" severity="success" styleClass="w-full h-12 mt-4" />
        </div>
      </form>
    </div>
  </div>
</div>

<p-dialog header="Recuperar Contraseña" [(visible)]="showForgotDialog" [modal]="true" [draggable]="false" [style]="{ width: '450px' }" (onHide)="resetRecoveryForm()">
  <div class="py-2">
    <div *ngIf="recoveryStep === 'email'" class="flex flex-col gap-4">
      <h4 class="font-bold text-lg">Busquemos tu cuenta</h4>
      <p class="text-surface-600 dark:text-surface-400">Ingresa tu correo para continuar.</p>
      <input pInputText [(ngModel)]="forgotEmail" placeholder="correo@ejemplo.com" class="w-full h-12" />
      <p-button label="Continuar" (onClick)="checkEmailAndContinue()" styleClass="w-full" />
    </div>

    <div *ngIf="recoveryStep === 'method'" class="flex flex-col gap-4">
      <h4 class="font-bold text-lg">¿Cómo quieres recuperar tu acceso?</h4>
      <div class="flex flex-col gap-3">
        <div class="flex items-center gap-3 p-4 border rounded-xl cursor-pointer hover:bg-primary/5 border-surface-200 dark:border-surface-700" 
             [class.border-primary]="recoveryMethod === 'email'" (click)="recoveryMethod = 'email'">
          <p-radioButton name="method" value="email" [(ngModel)]="recoveryMethod" />
          <div class="flex flex-col"><span class="font-bold text-sm">Código por correo</span><span class="text-xs opacity-60">Enviaremos un PIN de 6 dígitos</span></div>
        </div>
        <div class="flex items-center gap-3 p-4 border rounded-xl cursor-pointer hover:bg-primary/5 border-surface-200 dark:border-surface-700" 
             [class.border-primary]="recoveryMethod === 'security'" (click)="recoveryMethod = 'security'">
          <p-radioButton name="method" value="security" [(ngModel)]="recoveryMethod" />
          <div class="flex flex-col"><span class="font-bold text-sm">Pregunta de seguridad</span><span class="text-xs opacity-60">Responde la pregunta de tu cuenta</span></div>
        </div>
      </div>
      <p-button label="Continuar" (onClick)="recoveryMethod === 'email' ? sendResetCode() : recoveryStep = 'security'" styleClass="w-full mt-2" />
    </div>

    <div *ngIf="recoveryStep === 'code'" class="flex flex-col gap-3">
      <h4 class="font-bold">Verifica tu correo</h4>
      <p class="text-sm opacity-70">Código enviado a: <b>{{ forgotEmail }}</b></p>
      <input pInputText placeholder="Código de 6 dígitos" [(ngModel)]="resetCode" class="w-full text-center text-2xl tracking-widest" />
      <p-password placeholder="Nueva contraseña" [(ngModel)]="newPassword" [feedback]="false" styleClass="w-full" inputStyleClass="w-full" />
      <p-password placeholder="Confirmar contraseña" [(ngModel)]="confirmPassword" [feedback]="false" styleClass="w-full" inputStyleClass="w-full" />
      <p-button label="Restablecer Contraseña" (onClick)="resetPasswordByCode()" styleClass="w-full mt-2" />
    </div>

    <div *ngIf="recoveryStep === 'security'" class="flex flex-col gap-3">
      <h4 class="font-bold">Pregunta de Seguridad</h4>
      <div class="p-3 bg-surface-100 dark:bg-surface-800 rounded-lg italic text-center">"{{ securityQuestion }}"</div>
      <input pInputText placeholder="Tu respuesta" [(ngModel)]="securityAnswer" class="w-full" />
      <p-password placeholder="Nueva contraseña" [(ngModel)]="newPassword" [feedback]="false" styleClass="w-full" inputStyleClass="w-full" />
      <p-password placeholder="Confirmar contraseña" [(ngModel)]="confirmPassword" [feedback]="false" styleClass="w-full" inputStyleClass="w-full" />
      <p-button label="Restablecer Contraseña" (onClick)="resetPasswordByAnswer()" styleClass="w-full mt-2" />
    </div>

    <div *ngIf="recoveryStep === 'success'" class="text-center py-6 flex flex-col items-center gap-4">
      <i class="pi pi-check-circle text-6xl text-green-500"></i>
      <div>
        <h3 class="text-xl font-bold">¡Todo listo!</h3>
        <p class="opacity-70 text-sm">Tu contraseña ha sido actualizada.</p>
      </div>
    </div>
  </div>
</p-dialog>

<p-toast />